### Variables
@inventoryApi = http://localhost:3001
@orderApi = http://localhost:3002

############################################################
# INVENTORY SERVICE (Port 3001)
############################################################

### 1. Create a new Product
# @name createProduct
POST {{inventoryApi}}/products
Content-Type: application/json

{
    "name": "Laptop Pro 1",
    "price": 1200,
    "stock": 10
}

### 2. Get all Products
GET {{inventoryApi}}/products

############################################################
# ORDER SERVICE (Port 3002)
############################################################

### 3. Create a new Order (SUCCESS CASE)
# Processing flow: 
# 1. Order Service calls gRPC Inventory to check stock.
# 2. Order created with status PENDING.
# 3. Order Service calls gRPC Inventory to deduct stock.
# 4. Order Service calls gRPC Payment to process payment.
# 5. Order status updated to COMPLETED.
# @name createOrderSuccess
POST {{orderApi}}/orders
Content-Type: application/json

{
    "productId": "{{createProduct.response.body._id}}",
    "quantity": 1,
    "pricePerUnit": 1000
}

### 4. Get Order by ID (Should be COMPLETED)
@orderId = {{createOrderSuccess.response.body._id}}
GET {{orderApi}}/orders/{{orderId}}

### 5. Create a new Order (PAYMENT FAILED CASE)
# Flow: Amount > 1000 will trigger a mock payment failure.
# The order status should be CANCELLED and stock deduction should have been rolled back (in a real app).
# Note: This demo simple rollback by just updating order status to CANCELLED.
# @name createOrderPaymentFail
POST {{orderApi}}/orders
Content-Type: application/json

{
    "productId": "{{createProduct.response.body._id}}",
    "quantity": 1,
    "pricePerUnit": 1200
}

### 6. Get Order by ID (Should be CANCELLED)
@failedOrderId = {{createOrderSuccess.response.body._id}}
GET {{orderApi}}/orders/{{failedOrderId}}

### 7. Check stock again
# After 1 success order (quantity 1), stock should be 9 (from 10).
# The failed order (quantity 1) might have deducted stock before failing payment.
# (Current simple logic in order-service.js deducts stock then processes payment)
GET {{inventoryApi}}/products

### 8. Try to create an Order with quantity exceeding stock
# Should return Insufficient stock error from gRPC Inventory Service
POST {{orderApi}}/orders
Content-Type: application/json

{
    "productId": "{{createProduct.response.body._id}}",
    "quantity": 100,
    "pricePerUnit": 1200
}
